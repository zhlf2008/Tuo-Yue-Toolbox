<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海报生成器 | Poster Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;500;600;700;900&family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* CSS 变量系统 */
        :root {
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --gradient-2: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
            --gradient-3: linear-gradient(225deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-5: conic-gradient(from 0deg, #667eea, #764ba2, #f093fb, #fa709a, #667eea);
            --gradient-6: radial-gradient(circle at 20% 50%, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --gradient-7: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --gradient-8: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);
            --gradient-9: linear-gradient(45deg, #00d2ff 0%, #3a7bd5 100%);
            --gradient-10: linear-gradient(45deg, #ffecd2 0%, #fcb69f 100%);
            --gradient-11: linear-gradient(225deg, #84fab0 0%, #8fd3f4 100%);
            --gradient-12: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
            --gradient-13: linear-gradient(45deg, #fbc2eb 0%, #a6c1ee 100%);
            --gradient-14: linear-gradient(225deg, #fad0c4 0%, #ffd1ff 100%);
            --gradient-15: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-16: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            --gradient-17: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --gradient-18: linear-gradient(225deg, #30cfd0 0%, #330867 100%);
            --gradient-19: linear-gradient(45deg, #5ee7df 0%, #b490ca 100%);
            --gradient-20: linear-gradient(225deg, #d299c2 0%, #fef9d7 100%);
            --gradient-21: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            --gradient-22: linear-gradient(45deg, #f6d365 0%, #fda085 100%);
            --gradient-23: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            --gradient-24: linear-gradient(225deg, #a18cd1 0%, #fbc2eb 100%);
            --gradient-25: linear-gradient(45deg, #ffecd2 0%, #a18cd1 50%, #fbc2eb 100%);
            --gradient-26: linear-gradient(135deg, #fad0c4 0%, #ff9a9e 100%);
            --gradient-27: linear-gradient(225deg, #fbc2eb 0%, #a6c1ee 100%);
            --gradient-28: linear-gradient(45deg, #84fab0 0%, #8fd3f4 50%, #4facfe 100%);
            --gradient-29: linear-gradient(135deg, #d4fc79 0%, #96e6a1 50%, #00d2ff 100%);
            --gradient-30: linear-gradient(225deg, #a8edea 0%, #fed6e3 50%, #fa709a 100%);
            
            --font-display: 'Playfair Display', serif;
            --font-title: 'Noto Serif SC', serif;
            --font-body: 'Montserrat', 'Noto Serif SC', sans-serif;
            
            --shadow-subtle: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-strong: 0 12px 40px rgba(0, 0, 0, 0.15);
            
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.4;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        .container {
            display: grid;
            grid-template-columns: 500px 1fr;
            gap: 3rem;
            max-width: 1800px;
            margin: 0 auto;
            padding: 3rem;
            position: relative;
            z-index: 1;
            align-items: start;
            min-height: 100vh;
        }

        /* 控制面板包装器，用于处理滚动条 */
        .control-panel-wrapper {
            position: relative;
            width: 500px;
            grid-column: 1;
        }

        /* 海报预览面板 */
        .preview-panel {
            grid-column: 2;
        }

        /* 控制面板 */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 2rem;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.8);
            width: 500px; /* 固定宽度，包含滚动条空间 */
            box-sizing: content-box; /* 滚动条宽度包含在总宽度内 */
        }

        /* 控制面板内容区域 - 确保内容宽度固定 */
        .control-panel > * {
            width: 476px; /* 500px - 滚动条宽度 */
            box-sizing: border-box;
        }

        /* 自定义滚动条样式 */
        .control-panel::-webkit-scrollbar {
            width: 12px;
        }

        .control-panel::-webkit-scrollbar-track {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 6px;
        }

        .control-panel::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 6px;
        }

        .control-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        .panel-header {
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(102, 126, 234, 0.15);
            position: relative;
        }

        .panel-header::before {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #667eea, transparent);
        }

        .panel-title {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .panel-subtitle {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 400;
            letter-spacing: 0.02em;
        }

        /* 组件容器样式 */
        .component-group {
            margin-bottom: 2.5rem;
            opacity: 0;
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .component-group:nth-child(1) { animation-delay: 0.1s; }
        .component-group:nth-child(2) { animation-delay: 0.2s; }
        .component-group:nth-child(3) { animation-delay: 0.3s; }
        .component-group:nth-child(4) { animation-delay: 0.4s; }
        .component-group:nth-child(5) { animation-delay: 0.5s; }
        .component-group:nth-child(6) { animation-delay: 0.6s; }
        .component-group:nth-child(7) { animation-delay: 0.7s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .component-group-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
        }

        .component-group-title::before {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, #667eea, transparent);
        }

        .component-group-title svg {
            width: 20px;
            height: 20px;
            color: #667eea;
            filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.2));
        }

        .component-group-title span {
            font-size: 0.8rem;
            font-weight: 600;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .form-label {
            display: block;
            margin-bottom: 0.6rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #475569;
            letter-spacing: 0.02em;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.875rem 1.25rem;
            font-family: var(--font-body);
            font-size: 0.9rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            background: #fff;
            transition: all var(--transition-fast);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: #94a3b8;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* 背景组件 */
        .gradient-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 0.4rem;
            margin-bottom: 1rem;
        }

        .gradient-option {
            aspect-ratio: 1;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .gradient-option::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0);
            transition: background 0.3s ease;
        }

        .gradient-option:hover {
            transform: translateY(-2px) scale(1.05);
            border-color: #667eea;
        }

        .gradient-option:hover::before {
            background: rgba(255, 255, 255, 0.1);
        }

        .gradient-option.active {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transform: scale(1.08);
        }

        .gradient-option.active::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 1px solid #667eea;
            border-radius: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.5; transform: scale(1); }
        }

        /* 图片组件 */
        .image-upload {
            position: relative;
        }

        .image-upload input[type="file"] {
            display: none;
        }

        .image-upload-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 1.25rem;
            border: 2px dashed #cbd5e1;
            border-radius: 14px;
            background: #fff;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .image-upload-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-upload-btn > * {
            position: relative;
            z-index: 1;
        }

        .image-upload-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .image-upload-btn:hover::before {
            opacity: 0.05;
        }

        .image-preview {
            margin-top: 0.75rem;
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }

        .image-preview.show {
            display: block;
        }

        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        .image-preview-remove {
            display: block;
            width: 100%;
            padding: 0.5rem;
            margin-top: 0.5rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
        }

        /* 对齐按钮 */
        .align-buttons {
            display: flex;
            gap: 0.5rem;
            background: #f1f5f9;
            padding: 0.25rem;
            border-radius: 10px;
        }

        .align-btn {
            flex: 1;
            padding: 0.6rem;
            border: 1px solid transparent;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #64748b;
        }

        .align-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .align-btn.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            color: #667eea;
        }

        /* 嘉宾组件 */
        .guest-block {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            position: relative;
            transition: all var(--transition-fast);
        }

        .guest-block:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .guest-block-grid {
            display: flex;
            gap: 1rem;
        }

        .guest-photo-area {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            width: 120px;
            gap: 0.75rem;
        }

        .guest-photo-wrapper {
            width: 100%;
            height: 100px;
            flex-shrink: 0;
            position: relative;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            transition: all var(--transition-fast);
        }

        .guest-photo-wrapper:hover {
            transform: scale(1.05);
        }

        .guest-photo-preview {
            width: 100%;
            height: 100%;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
            overflow: hidden;
            position: relative;
        }

        .guest-photo-preview.has-image {
            border-style: solid;
            border-color: transparent;
        }

        .guest-photo-preview span {
            font-size: 0.7rem;
            color: #9ca3af;
            text-align: center;
            padding: 0.25rem;
        }

        .guest-photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        .guest-photo-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .guest-photo-wrapper:hover .guest-photo-overlay {
            opacity: 1;
        }

        .guest-photo-overlay svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .guest-photo-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, auto);
            gap: 0.25rem;
            width: 100%;
            padding: 0.25rem;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .guest-photo-controls .photo-control-btn:nth-child(1) {
            grid-column: 2;
        }

        .guest-photo-controls .photo-control-btn:nth-child(2) {
            grid-column: 1;
            grid-row: 2;
        }

        .guest-photo-controls .photo-control-btn:nth-child(3) {
            grid-column: 2;
            grid-row: 2;
        }

        .guest-photo-controls .photo-control-btn:nth-child(4) {
            grid-column: 3;
            grid-row: 2;
        }

        .guest-photo-controls .photo-control-btn:nth-child(5) {
            grid-column: 1;
            grid-row: 1;
        }

        .guest-photo-controls .photo-control-btn:nth-child(6) {
            grid-column: 3;
            grid-row: 1;
        }

        /* 布局切换按钮 */
        .guest-layout-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 0.25rem;
            width: 100%;
            padding: 0.25rem;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .layout-btn {
            padding: 0.3rem;
            border: 1.5px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #64748b;
            min-width: 24px;
            min-height: 24px;
        }

        .layout-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-1px);
        }

        .layout-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .layout-btn svg {
            width: 16px;
            height: 16px;
        }

        .photo-control-btn {
            padding: 0.3rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #64748b;
            min-width: 24px;
            min-height: 24px;
        }

        .photo-control-btn:hover {
            background: #667eea;
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .photo-control-btn svg {
            width: 12px;
            height: 12px;
        }

        .photo-control-btn.zoom-btn svg {
            width: 12px;
            height: 12px;
        }

        .photo-control-btn.move-btn svg {
            width: 16px;
            height: 16px;
        }

        .guest-info-area {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            position: relative;
            padding-top: 0;
        }

        .guest-name-wrapper {
            width: 50%;
            min-width: 0;
            padding-right: 0.5rem;
        }

        .guest-name-wrapper label,
        .guest-title-wrapper label,
        .guest-bio-wrapper label {
            display: block;
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.15rem;
            font-weight: 500;
        }

        .guest-title-wrapper,
        .guest-bio-wrapper {
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .guest-bio-wrapper textarea {
            flex: 1;
            min-height: 150px;
            height: 160px;
        }

        .guest-block input[type="text"],
        .guest-block textarea {
            width: 100%;
            min-width: 0;
            font-size: 0.875rem;
            padding: 0.6rem 0.75rem;
        }

        .guest-block textarea {
            min-height: 60px;
            font-size: 0.8rem;
            resize: none;
            overflow: hidden;
            field-sizing: content;
            min-rows: 2;
        }

        .guest-block input[type="file"] {
            display: none;
        }

        .guest-remove-btn {
            position: absolute;
            top: 0;
            right: 0;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: #ef4444;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(239, 68, 68, 0.2);
            transition: all var(--transition-fast);
            line-height: 1;
            z-index: 10;
        }

        .guest-remove-btn:hover {
            background: #dc2626;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
            transform: translateY(-1px);
        }

        .guest-remove-btn:hover {
            background: #c0392b;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
            transform: translateY(-1px);
        }

        /* 组件系统样式 */
        .components-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .poster-component {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            transition: all var(--transition-fast);
        }

        .poster-component.dragging {
            opacity: 0.5;
            border: 2px dashed #667eea;
        }

        .poster-component.drag-over {
            border-top: 3px solid #667eea;
        }

        .component-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-bottom: 1px solid #e2e8f0;
            cursor: move;
            user-select: none;
        }

        .component-drag-handle {
            color: #94a3b8;
            cursor: move;
            padding: 0.25rem;
        }

        .component-drag-handle:hover {
            color: #667eea;
        }

        .component-title {
            flex: 1;
            font-size: 0.85rem;
            font-weight: 600;
            color: #475569;
            padding-left: 0.5rem;
        }

        .component-actions {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .component-toggle-btn,
        .component-remove-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            font-size: 1rem;
        }

        .component-toggle-btn {
            background: #e2e8f0;
            color: #64748b;
        }

        .component-toggle-btn:hover {
            background: #667eea;
            color: white;
        }

        .component-remove-btn {
            background: #ef4444;
            color: white;
        }

        .component-remove-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .component-content {
            padding: 1rem;
            display: block;
        }

        .component-content.collapsed {
            display: none;
        }

        /* 图片组件样式选择 */
        .image-style-selector,
        .text-style-selector {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.25rem;
            background: #f1f5f9;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .image-style-selector,
        .text-style-selector {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }

        .image-style-btn,
        .text-style-btn {
            padding: 0.35rem 0.5rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            color: #64748b;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-style-btn:hover,
        .text-style-btn:hover {
            border-color: #667eea;
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .image-style-btn.active,
        .text-style-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* 海报样式控制 */
        .poster.rounded {
            border-radius: 20px;
        }

        .poster.squared {
            border-radius: 0;
        }

        /* 图片样式 */
        .poster-cover-image.style-default {
            border-radius: 12px;
            margin-top: 0;
        }

        .poster-cover-image.style-narrow {
            border-radius: 8px;
            width: 80%;
            margin: 0 auto 1rem auto;
        }

        .poster-cover-image.style-wide {
            border-radius: 8px;
            width: 100%;
            margin-top: 1rem;
        }

        .poster-cover-image.style-shadow {
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            margin-top: 1rem;
        }

        .poster-cover-image.style-bordered {
            border-radius: 12px;
            border: 4px solid white;
            margin-top: 1rem;
        }

        .poster-cover-image.style-spaced {
            border-radius: 8px;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        /* 文本框样式 */
        .poster-description.style-default {
            line-height: 1.8;
            opacity: 0.85;
        }

        .poster-description.style-elegant {
            line-height: 2;
            opacity: 0.9;
            font-size: 1.1rem;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .poster-description.style-compact {
            line-height: 1.5;
            opacity: 0.8;
            font-size: 0.95rem;
        }

        .poster-description.style-highlight {
            line-height: 1.6;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }

        .poster-description.style-shadow {
            line-height: 1.7;
            opacity: 0.85;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .poster-description.style-centered {
            line-height: 1.8;
            opacity: 0.85;
            text-align: center;
            padding: 0 2rem;
        }

        /* 组件类型选择弹窗 */
        .component-type-modal {
            display: none;
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 0.75rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: auto;
            max-width: calc(100% - 2rem);
            left: 50%;
            transform: translateX(-50%);
            top: 100%;
            margin-top: 0.5rem;
        }

        .component-type-modal.show {
            display: block;
        }

        .component-type-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            z-index: 999;
        }

        .component-type-backdrop.show {
            display: block;
        }

        .component-type-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            max-width: 100%;
            width: auto;
        }

        .component-type-option {
            padding: 0.6rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all var(--transition-fast);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            background: white;
            min-width: 80px;
            width: 80px;
            height: 60px;
            box-sizing: border-box;
        }

        .component-type-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .component-type-option svg {
            width: 18px;
            height: 18px;
            color: #667eea;
        }

        .component-type-option span {
            font-size: 0.7rem;
            font-weight: 500;
            color: #475569;
        }

        .component-type-modal-close {
            display: none;
        }

        /* 组件类型选择按钮组 - 在大按钮内显示 */
        .component-type-buttons {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            flex-wrap: nowrap;
            gap: 0.25rem;
            justify-content: space-evenly;
            align-items: center;
            padding: 0.6rem 0.5rem;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 14px;
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        .component-type-buttons .component-type-option {
            flex-shrink: 0;
            box-sizing: border-box;
        }

        .add-component-section:hover .component-type-buttons {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        .add-component-section:hover #addComponentBtn {
            opacity: 0;
            pointer-events: none;
        }

        .add-component-section {
            position: relative;
            transition: all 0.3s ease;
            height: 79px; /* 小按钮高度55px + 上下padding 24px */
        }

        #addComponentBtn {
            transition: all 0.3s ease;
            z-index: 1;
            height: 79px; /* 与容器高度一致 */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
        }

        .component-type-buttons .component-type-option {
            min-width: 58px;
            width: 58px;
            height: 55px;
            padding: 0.35rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.15rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            box-sizing: border-box;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .component-type-buttons .component-type-option:hover {
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .component-type-buttons .component-type-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .component-type-buttons .component-type-option:hover::before {
            left: 100%;
        }

        .component-type-buttons .component-type-option svg {
            width: 14px;
            height: 14px;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .component-type-buttons .component-type-option:hover svg {
            color: #5a67d8;
        }

        .component-type-buttons .component-type-option span {
            font-size: 0.6rem;
            font-weight: 600;
            color: #475569;
            line-height: 1;
            letter-spacing: 0.02em;
        }

        /* 人员组组件 */
        .personnel-group {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .personnel-group-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .personnel-group-title-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            background: white;
            color: #475569;
        }

        .personnel-group-title-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .personnel-group-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #64748b;
        }

        .personnel-group-toggle-switch {
            width: 36px;
            height: 20px;
            background: #cbd5e1;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .personnel-group-toggle-switch.active {
            background: #667eea;
        }

        .personnel-group-toggle-switch::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform var(--transition-fast);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .personnel-group-toggle-switch.active::after {
            transform: translateX(16px);
        }

        .personnel-group-remove {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: #ef4444;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(239, 68, 68, 0.2);
            transition: all var(--transition-fast);
            line-height: 1;
        }

        .personnel-group-remove:hover {
            background: #dc2626;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
            transform: translateY(-1px);
        }

        .personnel-group-content {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .personnel-group-persons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .add-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            height: 100%;
            padding: 1.25rem;
            border: 2px dashed #cbd5e1;
            border-radius: 14px;
            background: #fff;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            box-shadow: none;
        }

        .add-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .add-btn > * {
            position: relative;
            z-index: 1;
        }

        .add-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .add-btn:hover::before {
            opacity: 0.05;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* 开关组件 */
        .toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem 0;
            border-bottom: 1px solid rgba(102, 126, 234, 0.08);
            transition: all 0.3s ease;
        }

        .toggle-item:last-child {
            border-bottom: none;
        }

        .toggle-item:hover {
            background: rgba(102, 126, 234, 0.03);
            border-radius: 8px;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: #475569;
            font-weight: 500;
        }

        .toggle-label svg {
            color: #667eea;
            filter: drop-shadow(0 1px 2px rgba(102, 126, 234, 0.15));
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            background: #cbd5e1;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        /* 导出按钮 */
        .export-section {
            position: relative;
        }

        .export-section::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #667eea, transparent);
        }

        .export-btn {
            width: 100%;
            padding: 1.125rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .export-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .export-btn:hover::before {
            left: 100%;
        }

        .export-btn:active {
            transform: translateY(-1px);
        }

        /* 控制按钮 */
        .control-btn {
            padding: 1.125rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            flex: 1;
            min-width: 140px;
            max-width: 200px;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .control-btn:active {
            transform: translateY(-1px);
        }

        /* 紧凑按钮样式 */
        .control-btn.compact,
        .export-btn.compact {
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
            min-width: 0;
            max-width: none;
            flex: 1 1 0;
            width: auto;
        }

        .control-btn.compact svg,
        .export-btn.compact svg {
            width: 14px;
            height: 14px;
        }

        /* 海报预览 */
        .preview-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .poster {
            width: 600px;
            min-height: 800px;
            background: var(--gradient-1);
            border-radius: 20px;
            padding: 3rem;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-strong);
        }

        .poster.rounded {
            border-radius: 20px;
        }

        .poster.squared {
            border-radius: 0;
        }

        .poster-content {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .poster-component-wrapper {
            display: block;
        }

        .poster-component-wrapper.hidden {
            display: none;
        }

        .poster-title {
            font-family: var(--font-title);
            font-size: 3rem;
            font-weight: 700;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .poster-subtitle {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 400;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .poster-description {
            font-size: 1rem;
            line-height: 1.8;
            opacity: 0.85;
        }

        .poster-cover-image {
            width: 100%;
            height: auto;
            border-radius: 12px;
            margin: 0;
            display: block;
        }

        .poster-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .poster-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .poster-guests {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        /* 嘉宾显示样式 - 三种模式 */
        .poster-guest {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        /* 模式1: 只有姓名 - 单排大字体 */
        .poster-guest.name-only {
            justify-content: flex-start;
            padding: 1rem 1.25rem;
        }

        .poster-guest.name-only .poster-guest-info {
            display: flex;
            align-items: center;
        }

        .poster-guest.name-only .poster-guest-name {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.02em;
        }

        /* 模式2: 姓名+头衔 - 双排显示 */
        .poster-guest.with-title {
            align-items: center;
        }

        .poster-guest.with-title .poster-guest-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .poster-guest.with-title .poster-guest-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .poster-guest.with-title .poster-guest-title {
            font-size: 0.9rem;
            opacity: 0.85;
            font-weight: 400;
        }

        /* 模式3: 姓名+头衔+简介 - 左右布局 */
        .poster-guest.with-bio {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .poster-guest.with-bio .poster-guest-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .poster-guest.with-bio .poster-guest-info {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .poster-guest.with-bio .poster-guest-name {
            font-size: 1rem;
            font-weight: 600;
        }

        .poster-guest.with-bio .poster-guest-title {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .poster-guest.with-bio .poster-guest-bio {
            flex: 1;
            font-size: 0.85rem;
            line-height: 1.6;
            opacity: 0.8;
            padding-left: 1rem;
            border-left: 1px solid rgba(255,255,255,0.2);
            margin-left: 0.5rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* 长简介模式 - 照片姓名头衔上下排列，简介仍在右侧 */
        .poster-guest.with-bio-long .poster-guest-left {
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            width: 100px;
            flex-shrink: 0;
        }

        .poster-guest.with-bio-long .poster-guest-avatar {
            width: 60px;
            height: 60px;
        }

        .poster-guest.with-bio-long .poster-guest-info {
            text-align: center;
            align-items: center;
        }

        .poster-guest.with-bio-long .poster-guest-name {
            font-size: 0.9rem;
        }

        .poster-guest.with-bio-long .poster-guest-title {
            font-size: 0.75rem;
        }

        .poster-guest.with-bio-long .poster-guest-bio {
            border-left: 1px solid rgba(255,255,255,0.2);
            border-top: none;
            padding-left: 1rem;
            padding-top: 0;
            margin-left: 0.5rem;
            margin-top: 0;
        }

        /* ===== 三种布局样式 ===== */
        
        /* 紧凑布局 (compact) - 默认 */
        .poster-guest.layout-compact {
            /* 使用默认样式 */
        }

        /* 卡片布局 (card) */
        .poster-guest.layout-card {
            background: rgba(255,255,255,0.25);
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 1.25rem;
        }

        .poster-guest.layout-card .poster-guest-avatar {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .poster-guest.layout-card.name-only .poster-guest-name {
            font-size: 1.6rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* 极简布局 (minimal) */
        .poster-guest.layout-minimal {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            border-radius: 0;
            padding: 0.75rem 0.5rem;
        }

        .poster-guest.layout-minimal .poster-guest-avatar {
            width: 50px;
            height: 50px;
            background: transparent;
            border: 2px solid rgba(255,255,255,0.5);
        }

        .poster-guest.layout-minimal.name-only .poster-guest-name {
            font-size: 1.3rem;
            font-weight: 500;
            letter-spacing: 0.05em;
        }

        .poster-guest.layout-minimal.with-title .poster-guest-name {
            font-size: 1rem;
            font-weight: 500;
        }

        .poster-guest.layout-minimal.with-title .poster-guest-title {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .poster-guest.layout-minimal.with-bio .poster-guest-bio {
            border-left-color: rgba(255,255,255,0.15);
            font-size: 0.8rem;
        }

        /* 纯文字布局 (text) - 无图片 */
        .poster-guest.layout-text {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
        }

        .poster-guest.layout-text .poster-guest-avatar {
            display: none;
        }

        .poster-guest.layout-text.name-only {
            justify-content: center;
            text-align: center;
        }

        .poster-guest.layout-text.name-only .poster-guest-name {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 0.08em;
        }

        .poster-guest.layout-text.with-title {
            align-items: center;
        }

        .poster-guest.layout-text.with-title .poster-guest-info {
            gap: 0.35rem;
        }

        .poster-guest.layout-text.with-title .poster-guest-name {
            font-size: 1.6rem;
            font-weight: 700;
        }

        .poster-guest.layout-text.with-title .poster-guest-title {
            font-size: 1rem;
            opacity: 0.8;
            font-weight: 400;
        }

        .poster-guest.layout-text.with-bio {
            flex-direction: row;
            align-items: center;
            gap: 1.5rem;
        }

        .poster-guest.layout-text.with-bio .poster-guest-left {
            flex-shrink: 0;
            width: auto;
            min-width: 120px;
        }

        .poster-guest.layout-text.with-bio .poster-guest-info {
            gap: 0.25rem;
        }

        .poster-guest.layout-text.with-bio .poster-guest-name {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .poster-guest.layout-text.with-bio .poster-guest-title {
            font-size: 0.9rem;
            opacity: 0.75;
        }

        .poster-guest.layout-text.with-bio .poster-guest-bio {
            flex: 1;
            border-left: 1px solid rgba(255,255,255,0.25);
            padding-left: 1.25rem;
            margin-left: 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* ===== 第五种布局：侧边布局 (sidebar) ===== */
        .poster-guest.layout-sidebar {
            flex-direction: row;
            align-items: center;
            gap: 1.5rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.12);
            border-left: 4px solid rgba(255,255,255,0.3);
            border-radius: 0 10px 10px 0;
        }

        .poster-guest.layout-sidebar .poster-guest-avatar {
            width: 85px;
            height: 85px;
            border-radius: 12px;
            background: rgba(255,255,255,0.25);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .poster-guest.layout-sidebar.name-only {
            justify-content: flex-start;
        }

        .poster-guest.layout-sidebar.name-only .poster-guest-name {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 0.03em;
        }

        .poster-guest.layout-sidebar.with-title .poster-guest-info {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .poster-guest.layout-sidebar.with-title .poster-guest-name {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .poster-guest.layout-sidebar.with-title .poster-guest-title {
            font-size: 0.95rem;
            opacity: 0.85;
        }

        .poster-guest.layout-sidebar.with-bio {
            align-items: flex-start;
        }

        .poster-guest.layout-sidebar.with-bio .poster-guest-left {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .poster-guest.layout-sidebar.with-bio .poster-guest-info {
            text-align: left;
            align-items: flex-start;
        }

        .poster-guest.layout-sidebar.with-bio .poster-guest-name {
            font-size: 1.1rem;
        }

        .poster-guest.layout-sidebar.with-bio .poster-guest-title {
            font-size: 0.9rem;
        }

        .poster-guest.layout-sidebar.with-bio .poster-guest-bio {
            border-left: 1px solid rgba(255,255,255,0.3);
            padding-left: 1rem;
            margin-left: 0.5rem;
            font-size: 0.85rem;
            line-height: 1.7;
        }

        /* ===== 第六种布局：网格布局 (grid) ===== */
        .poster-guest.layout-grid {
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding-top: 1.25rem;
            padding-bottom: 1.25rem;
            padding-left: 1.25rem;
            padding-right: 1.25rem;
            background: rgba(255,255,255,0.08);
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.15);
        }

        .poster-guest.layout-grid .poster-guest-avatar {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            margin-bottom: 0.75rem;
            border: 2px solid rgba(255,255,255,0.25);
        }

        .poster-guest.layout-grid.with-bio .poster-guest-avatar {
            width: 100px;
            height: 100px;
            flex-shrink: 0;
        }

        .poster-guest.layout-grid.name-only {
            padding-left: 1.25rem;
        }

        .poster-guest.layout-grid.name-only .poster-guest-name {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .poster-guest.layout-grid.with-title {
            padding-left: 1.25rem;
        }

        .poster-guest.layout-grid.with-title .poster-guest-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .poster-guest.layout-grid.with-title .poster-guest-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .poster-guest.layout-grid.with-title .poster-guest-title {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .poster-guest.layout-grid.with-bio {
            flex-direction: column;
            align-items: stretch;
            padding-top: 1.25rem;
            padding-left: 1.25rem;
            text-align: left;
        }

        .poster-guest.layout-grid.with-bio .poster-guest-left {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 2rem;
            margin-top: 0;
            margin-bottom: 1.5rem;
            padding: 0;
            padding-left: 1.5rem;
        }

        .poster-guest.layout-grid.with-bio .poster-guest-info {
            text-align: left;
            align-items: flex-start;
            flex-direction: column;
        }

        .poster-guest.layout-grid.with-bio .poster-guest-name {
            font-size: 1.3rem;
            line-height: 1.3;
        }

        .poster-guest.layout-grid.with-bio .poster-guest-title {
            font-size: 1rem;
        }

        .poster-guest.layout-grid.with-bio .poster-guest-bio {
            text-align: left;
            font-size: 0.85rem;
            line-height: 1.6;
            opacity: 0.75;
            width: calc(100% - 3rem);
            padding: 1.5rem 1.5rem 1rem 1.5rem;
            margin: 1.5rem auto 0;
            position: relative;
            border-left: none;
        }

        .poster-guest.layout-grid.with-bio .poster-guest-bio::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            height: 2px;
            background: rgba(255,255,255,0.4);
        }

        .poster-guest-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.5rem;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }

        .poster-guest-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .poster-guest-info {
            flex: 1;
        }

        .poster-guest-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .poster-guest-title {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .poster-guest-bio {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 0.25rem;
        }

        .poster-footer {
            margin-top: auto;
            padding-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .poster-footer-divider {
            width: 100%;
            height: 1px;
            background: rgba(255,255,255,0.2);
            margin: 0.5rem 0;
        }

        .poster-info-group {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .poster-info-group-vertical {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .poster-info {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .poster-info svg {
            width: 16px;
            height: 16px;
            opacity: 0.8;
        }

        .poster-qr {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            color: #333;
        }

        .poster-qr img {
            width: 80px;
            height: 80px;
        }

        .poster-qr-text {
            flex: 1;
        }

        .poster-qr-text h3 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .poster-qr-text p {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* 二维码样式选择器 */
        .qr-style-selector {
            display: flex;
            gap: 0.3rem;
            flex-wrap: wrap;
        }

        .qr-style-btn {
            padding: 0.4rem 0.6rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
        }

        .qr-style-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .qr-style-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        /* 二维码组件样式变体 */
        .qr-wrapper-default {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
        }

        .poster-qr.style-default {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            background: white;
            padding: 0.8rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            flex-shrink: 0;
        }

        .poster-qr.style-default img {
            width: 70px;
            height: 70px;
        }

        .poster-info-group-right {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            padding-top: 1rem;
        }

        .poster-info-group-right .poster-info {
            font-size: 0.95rem;
        }

        .poster-info-group-right .poster-info svg {
            width: 15px;
            height: 15px;
        }

        .poster-qr.style-minimal {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 1.5rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.2rem 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .qr-section-left {
            flex-shrink: 0;
        }

        .poster-qr.style-minimal img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            background: white;
            padding: 6px;
        }

        .qr-section-right {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .poster-qr.style-minimal .event-detail {
            color: rgba(255, 255, 255, 0.9);
        }

        .poster-qr.style-card {
            display: flex;
            flex-direction: row;
            align-items: center;
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            gap: 1.5rem;
        }

        .poster-qr.style-card img {
            width: 70px;
            height: 70px;
            border-radius: 0;
        }

        .poster-qr.style-card .poster-event-details {
            font-size: 0.85rem;
        }

        .poster-qr.style-card .event-detail {
            font-size: 0.85rem;
        }

        .poster-qr.style-card .event-detail svg {
            width: 16px;
            height: 16px;
        }

        .qr-wrapper-horizontal {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
        }

        .poster-qr.style-horizontal {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 12px;
            padding: 0.6rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .horizontal-info {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            text-align: center;
        }

        .horizontal-info .poster-info {
            justify-content: center;
            font-size: 0.85rem;
        }

        .horizontal-info .poster-info svg {
            width: 15px;
            height: 15px;
        }

        .poster-qr.style-horizontal img {
            width: 70px;
            height: 70px;
        }

        .poster-qr.style-elegant {
            display: flex;
            flex-direction: row;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: rgba(255, 255, 255, 0.95);
            gap: 1.5rem;
        }

        .poster-qr.style-elegant img {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            background: white;
            padding: 6px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .poster-qr.style-elegant .qr-section-right {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .poster-qr.style-elegant .event-detail {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
        }

        .poster-qr.style-elegant .event-detail svg {
            width: 14px;
            height: 14px;
        }

        /* 二维码上传按钮样式 */
        .qr-link-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qr-upload-btn {
            display: none;
        }

        .qr-upload-icon {
            width: 42px;
            height: 42px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .qr-upload-icon:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .qr-upload-icon.has-image {
            border-color: #ef4444;
            color: #ef4444;
        }

        .qr-upload-icon.has-image:hover {
            background: #fef2f2;
        }

        .poster-qr-divider {
            width: 1px;
            height: 40px;
            background: rgba(0, 0, 0, 0.1);
            margin: 0 1.5rem;
        }

        .poster-event-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 120px;
        }

        .event-detail {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            color: #333;
        }

        .event-detail svg {
            width: 14px;
            height: 14px;
            opacity: 0.8;
            flex-shrink: 0;
        }

        .event-icon {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr;
            }
            .control-panel {
                position: static;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 控制面板 -->
        <div class="control-panel">
            <div class="panel-header">
                <a href="index.html" style="display: inline-flex; align-items: center; gap: 0.5rem; color: #667eea; text-decoration: none; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; transition: color 0.2s; font-family: var(--font-body);">
                    <span>←</span>
                    <span>返回工具箱</span>
                </a>
                <h1 class="panel-title">海报生成器</h1>
                <p class="panel-subtitle">配置内容，一键导出精美海报</p>
            </div>

            <!-- 控制按钮区域 -->
            <div class="control-buttons-section" style="margin-top: 1rem; margin-bottom: 2rem; padding-bottom: 1.5rem;">
                <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: nowrap; justify-content: space-between; width: 100%; margin: 0 auto;">
                    <button type="button" class="control-btn compact" id="toggleAllComponentsBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="18 15 12 9 6 15"/>
                        </svg>
                        <span>全部展开</span>
                    </button>
                    <button type="button" class="control-btn compact" id="setCornerBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        </svg>
                        <span>圆角</span>
                    </button>
                    <button type="button" class="export-btn compact" id="exportBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span>导出海报</span>
                    </button>
                </div>
            </div>

            <!-- 背景组件 -->
            <div class="component-group">
                <div class="component-group-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                    <span>背景设置</span>
                </div>
                <label class="form-label">选择背景样式</label>
                <div class="gradient-grid" id="gradientGrid">
                    <div class="gradient-option active" style="background: var(--gradient-1)" data-gradient="1"></div>
                    <div class="gradient-option" style="background: var(--gradient-2)" data-gradient="2"></div>
                    <div class="gradient-option" style="background: var(--gradient-3)" data-gradient="3"></div>
                    <div class="gradient-option" style="background: var(--gradient-4)" data-gradient="4"></div>
                    <div class="gradient-option" style="background: var(--gradient-5)" data-gradient="5"></div>
                    <div class="gradient-option" style="background: var(--gradient-6)" data-gradient="6"></div>
                    <div class="gradient-option" style="background: var(--gradient-7)" data-gradient="7"></div>
                    <div class="gradient-option" style="background: var(--gradient-8)" data-gradient="8"></div>
                    <div class="gradient-option" style="background: var(--gradient-9)" data-gradient="9"></div>
                    <div class="gradient-option" style="background: var(--gradient-10)" data-gradient="10"></div>
                    <div class="gradient-option" style="background: var(--gradient-11)" data-gradient="11"></div>
                    <div class="gradient-option" style="background: var(--gradient-12)" data-gradient="12"></div>
                    <div class="gradient-option" style="background: var(--gradient-13)" data-gradient="13"></div>
                    <div class="gradient-option" style="background: var(--gradient-14)" data-gradient="14"></div>
                    <div class="gradient-option" style="background: var(--gradient-15)" data-gradient="15"></div>
                    <div class="gradient-option" style="background: var(--gradient-16)" data-gradient="16"></div>
                    <div class="gradient-option" style="background: var(--gradient-17)" data-gradient="17"></div>
                    <div class="gradient-option" style="background: var(--gradient-18)" data-gradient="18"></div>
                    <div class="gradient-option" style="background: var(--gradient-19)" data-gradient="19"></div>
                    <div class="gradient-option" style="background: var(--gradient-20)" data-gradient="20"></div>
                    <div class="gradient-option" style="background: var(--gradient-21)" data-gradient="21"></div>
                    <div class="gradient-option" style="background: var(--gradient-22)" data-gradient="22"></div>
                    <div class="gradient-option" style="background: var(--gradient-23)" data-gradient="23"></div>
                    <div class="gradient-option" style="background: var(--gradient-24)" data-gradient="24"></div>
                    <div class="gradient-option" style="background: var(--gradient-25)" data-gradient="25"></div>
                    <div class="gradient-option" style="background: var(--gradient-26)" data-gradient="26"></div>
                    <div class="gradient-option" style="background: var(--gradient-27)" data-gradient="27"></div>
                    <div class="gradient-option" style="background: var(--gradient-28)" data-gradient="28"></div>
                    <div class="gradient-option" style="background: var(--gradient-29)" data-gradient="29"></div>
                    <div class="gradient-option" style="background: var(--gradient-30)" data-gradient="30"></div>
                </div>
            </div>

            <!-- 组件管理区域 -->
            <div class="component-group">
                <div class="component-group-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                        <path d="M16 3.13a4 4 0 010 7.75"/>
                    </svg>
                    <span>海报组件</span>
                </div>

                <div id="componentsContainer" class="components-container"></div>
                
                <!-- 添加组件区域 -->
                <div class="add-component-section" id="addComponentContainer">
                    <button type="button" class="add-btn" id="addComponentBtn" style="margin-top: 1rem;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span>添加组件</span>
                    </button>
                    
                    <!-- 组件类型选择按钮组 -->
                    <div class="component-type-buttons" id="componentTypeButtons">
                        <div class="component-type-option" data-type="main-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 6h16M4 12h16M4 18h8"/>
                            </svg>
                            <span>主标题</span>
                        </div>
                        <div class="component-type-option" data-type="sub-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 7h16M9 12h11M9 17h7"/>
                            </svg>
                            <span>副标题</span>
                        </div>
                        <div class="component-type-option" data-type="text-box">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16v16H4z"/>
                                <path d="M8 8h8M8 12h8M8 16h5"/>
                            </svg>
                            <span>文本块</span>
                        </div>
                        <div class="component-type-option" data-type="image">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <span>图片框</span>
                        </div>
                        <div class="component-type-option" data-type="qrcode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <path d="M3 21h7v-7H3v7z"/>
                            </svg>
                            <span>二维码</span>
                        </div>
                        <div class="component-type-option" data-type="personnel">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                                <path d="M16 3.13a4 4 0 010 7.75"/>
                            </svg>
                            <span>人员组</span>
                        </div>
                    </div>
                </div>
                <!-- 外部滚动条 -->
                <div class="control-panel-scrollbar">
                    <div class="control-panel-scrollbar-thumb"></div>
                </div>
            </div>
        </div>

        <!-- 海报预览 -->
        <div class="preview-panel">
            <div class="poster" id="poster">
                <div class="poster-content">
                    <div class="poster-title" id="posterTitle">年度设计大会</div>
                    <div class="poster-subtitle" id="posterSubtitle">Annual Design Conference 2024</div>
                    <div class="poster-description" id="posterDescription">探索设计的边界，共创美好未来。本次大会将汇聚全球顶尖设计师，分享最新设计趋势与创新思维。</div>

                    <!-- 海报底部二维码 -->
                    <div class="poster-footer">
                        <div class="poster-info-group">
                            <div class="poster-info">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                <span id="posterDate">2024年3月15日</span>
                            </div>
                            <div class="poster-info">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                <span id="posterLocation">线上会议</span>
                            </div>
                        </div>
                        
                        <div class="poster-footer-divider"></div>
                        
                        <div class="poster-qr">
                            <img id="posterQrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://example.com/event" alt="二维码">
                            <div class="poster-qr-text">
                                <h3 id="posterQrText">扫码查看</h3>
                                <p>Scan to view</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 组件数据
        let posterComponents = [];
        let componentCounter = 0;

        // 人员组数据（嵌套在人员组件中）
        let personnelGroups = [];
        let groupCounter = 0;

        // 组件类型定义
        const componentTypes = {
            'main-title': {
                name: '主标题',
                icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h8"/></svg>'
            },
            'sub-title': {
                name: '副标题',
                icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7h16M9 12h11M9 17h7"/></svg>'
            },
            'text-box': {
                name: '文本框',
                icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16v16H4z"/><path d="M8 8h8M8 12h8M8 16h5"/></svg>'
            },
            'image': {
                name: '图片',
                icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>'
            },
            'qrcode': {
                name: '二维码',
                icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><path d="M3 21h7v-7H3v7z"/></svg>'
            },
            'personnel': {
                name: '人员介绍',
                icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>'
            }
        };

        // 初始化组件系统
        const initComponentSystem = () => {
            console.log('初始化组件系统...');
            const container = document.getElementById('componentsContainer');

            if (!container) {
                console.error('未找到 componentsContainer 容器');
                return;
            }

            // 清空现有组件
            container.innerHTML = '';
            posterComponents = [];
            componentCounter = 0;

            // 创建默认组件
            const defaultComponents = [
                {
                    type: 'main-title',
                    visible: true,
                    data: { text: '年度设计大会', align: 'left' }
                },
                {
                    type: 'sub-title',
                    visible: true,
                    data: { text: 'Annual Design Conference 2024', align: 'left' }
                },
                {
                    type: 'text-box',
                    visible: true,
                    data: { text: '探索设计的边界，共创美好未来。本次大会将汇聚全球顶尖设计师，分享最新设计趋势与创新思维。' }
                },
                {
                    type: 'personnel',
                    visible: true,
                    data: { personnelGroups: [] }
                },
                {
                    type: 'qrcode',
                    visible: true,
                    data: { 
                        link: 'https://example.com/event', 
                        text: '扫码查看', 
                        subtitle: 'Scan to view',
                        time: '2024年3月15日  06:00-07:00',
                        location: '浙江省桐乡市凯旋路1888号'
                    }
                }
            ];

            defaultComponents.forEach(comp => {
                createComponent(comp);
            });

            updatePoster();
        };

        // 创建组件
        const createComponent = (data = {}) => {
            const container = document.getElementById('componentsContainer');

            if (!container) {
                console.error('未找到 componentsContainer 容器');
                return;
            }

            const componentId = ++componentCounter;
            const componentType = data.type || 'text-box';
            const componentData = {
                id: componentId,
                type: componentType,
                visible: data.visible !== undefined ? data.visible : true,
                data: data.data || {}
            };

            posterComponents.push(componentData);

            const component = document.createElement('div');
            component.className = 'poster-component';
            component.dataset.componentId = componentId;
            component.draggable = true;

            const typeInfo = componentTypes[componentType];

            component.innerHTML = `
                <div class="component-header">
                    <div class="component-drag-handle">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="12" r="1"/>
                            <circle cx="9" cy="5" r="1"/>
                            <circle cx="9" cy="19" r="1"/>
                            <circle cx="15" cy="12" r="1"/>
                            <circle cx="15" cy="5" r="1"/>
                            <circle cx="15" cy="19" r="1"/>
                        </svg>
                    </div>
                    <span class="component-title">${typeInfo.name}</span>
                    <div class="component-actions">
                        <button type="button" class="component-toggle-btn" data-component-id="${componentId}" title="折叠/展开">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"/>
                            </svg>
                        </button>
                        <button type="button" class="component-remove-btn" data-component-id="${componentId}" title="删除组件">×</button>
                    </div>
                </div>
                <div class="component-content">
                    ${getComponentContent(componentType, componentData)}
                </div>
            `;

            container.appendChild(component);

            // 绑定组件事件
            bindComponentEvents(component, componentData);

            return component;
        };

        // 重新渲染组件
        const renderComponent = (compData) => {
            const component = document.querySelector(`[data-component-id="${compData.id}"]`);
            if (component) {
                const content = component.querySelector('.component-content');
                if (content) {
                    content.innerHTML = getComponentContent(compData.type, compData);
                    bindComponentEvents(component, compData);
                }
            }
        };

        // 获取组件内容HTML
        const getComponentContent = (type, data) => {
            switch(type) {
                case 'main-title':
                    return `
                        <label class="form-label">主标题</label>
                        <input type="text" class="form-input component-input-text" value="${data.data.text || ''}" placeholder="输入主标题" data-field="text">
                        <div class="align-buttons component-align-buttons" data-field="align" style="margin-top: 0.5rem;">
                            <button type="button" class="align-btn ${data.data.align === 'left' ? 'active' : ''}" data-align="left" title="左对齐">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z"/></svg>
                            </button>
                            <button type="button" class="align-btn ${data.data.align === 'center' ? 'active' : ''}" data-align="center" title="居中对齐">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z"/></svg>
                            </button>
                            <button type="button" class="align-btn ${data.data.align === 'right' ? 'active' : ''}" data-align="right" title="右对齐">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z"/></svg>
                            </button>
                        </div>
                    `;
                case 'sub-title':
                    return `
                        <label class="form-label">副标题</label>
                        <input type="text" class="form-input component-input-text" value="${data.data.text || ''}" placeholder="输入副标题" data-field="text">
                        <div class="align-buttons component-align-buttons" data-field="align" style="margin-top: 0.5rem;">
                            <button type="button" class="align-btn ${data.data.align === 'left' ? 'active' : ''}" data-align="left" title="左对齐">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm0 15h14v2H3v-2zm0-5h18v2H3v-2zm0-5h14v2H3V9z"/></svg>
                            </button>
                            <button type="button" class="align-btn ${data.data.align === 'center' ? 'active' : ''}" data-align="center" title="居中对齐">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm2 15h14v2H5v-2zm-2-5h18v2H3v-2zm2-5h14v2H5V9z"/></svg>
                            </button>
                            <button type="button" class="align-btn ${data.data.align === 'right' ? 'active' : ''}" data-align="right" title="右对齐">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm4 15h14v2H7v-2zm-4-5h18v2H3v-2zm4-5h14v2H7V9z"/></svg>
                            </button>
                        </div>
                    `;
                case 'text-box':
                    return `
                        <label class="form-label">文本内容</label>
                        <textarea class="form-textarea component-input-text" placeholder="输入文本内容" data-field="text">${data.data.text || ''}</textarea>
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; margin-top: 0.75rem;">
                            <label class="form-label" style="margin-bottom: 0;">文本样式</label>
                            <div class="text-style-selector component-text-style" data-field="style">
                                <button type="button" class="text-style-btn ${data.data.style === 'default' ? 'active' : ''}" data-style="default">默认</button>
                                <button type="button" class="text-style-btn ${data.data.style === 'elegant' ? 'active' : ''}" data-style="elegant">优雅</button>
                                <button type="button" class="text-style-btn ${data.data.style === 'compact' ? 'active' : ''}" data-style="compact">紧凑</button>
                                <button type="button" class="text-style-btn ${data.data.style === 'highlight' ? 'active' : ''}" data-style="highlight">高亮</button>
                                <button type="button" class="text-style-btn ${data.data.style === 'shadow' ? 'active' : ''}" data-style="shadow">阴影</button>
                                <button type="button" class="text-style-btn ${data.data.style === 'centered' ? 'active' : ''}" data-style="centered">居中</button>
                            </div>
                        </div>
                    `;
                case 'image':
                    return `
                        <label class="form-label">上传图片</label>
                        <div class="image-upload">
                            <input type="file" class="component-image-input" accept="image/*" data-field="image" id="image-upload-${data.id}">
                            ${data.data.image ? `
                                <div class="image-preview show" id="image-preview-${data.id}">
                                    <img src="${data.data.image}" alt="图片预览">
                                    <button type="button" class="image-preview-remove component-remove-image">移除图片</button>
                                </div>
                            ` : `
                                <label class="image-upload-btn" for="image-upload-${data.id}">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                    <span>点击上传图片</span>
                                </label>
                            `}
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem; margin-top: 0.75rem;">
                            <label class="form-label" style="margin-bottom: 0;">图片样式</label>
                            <div class="image-style-selector component-image-style" data-field="style">
                                <button type="button" class="image-style-btn ${data.data.style === 'default' ? 'active' : ''}" data-style="default">默认</button>
                                <button type="button" class="image-style-btn ${data.data.style === 'narrow' ? 'active' : ''}" data-style="narrow">窄幅</button>
                                <button type="button" class="image-style-btn ${data.data.style === 'wide' ? 'active' : ''}" data-style="wide">宽幅</button>
                                <button type="button" class="image-style-btn ${data.data.style === 'shadow' ? 'active' : ''}" data-style="shadow">阴影</button>
                                <button type="button" class="image-style-btn ${data.data.style === 'bordered' ? 'active' : ''}" data-style="bordered">边框</button>
                                <button type="button" class="image-style-btn ${data.data.style === 'spaced' ? 'active' : ''}" data-style="spaced">间距</button>
                            </div>
                        </div>
                    `;
                case 'qrcode':
                    return `
                        <label class="form-label">时间设置</label>
                        <input type="text" class="form-input component-input-text" value="${data.data.time || '2024年3月15日  06:00-07:00'}" placeholder="例如：2024年12月31日 19:00" data-field="time">
                        <label class="form-label" style="margin-top: 1rem;">地点设置</label>
                        <input type="text" class="form-input component-input-text" value="${data.data.location || '浙江省桐乡市凯旋路1888号'}" placeholder="例如：北京国家大剧院" data-field="location">
                        
                        <div class="form-divider" style="margin: 1.5rem 0;"></div>
                        
                        <label class="form-label">二维码设置</label>
                        <div class="qr-link-wrapper">
                            <input type="file" class="qr-upload-btn component-qrcode-input" accept="image/*" data-field="qrcodeImage" id="qrcode-upload-${data.id}" style="display: none;">
                            ${data.data.qrcodeImage ? `
                                <button type="button" class="qr-upload-icon has-image" data-upload-id="${data.id}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                            ` : `
                                <button type="button" class="qr-upload-icon" data-upload-id="${data.id}">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                </button>
                            `}
                            <input type="text" class="form-input component-input-text" value="${data.data.link || 'https://example.com/event'}" placeholder="输入二维码链接" data-field="link">
                        </div>
                        
                        <div class="form-divider" style="margin: 1.5rem 0;"></div>
                        
                        <label class="form-label">二维码样式</label>
                        <div class="qr-style-selector component-qr-style" data-field="qrStyle">
                            <button type="button" class="qr-style-btn ${data.data.qrStyle === 'default' ? 'active' : ''}" data-style="default">默认</button>
                            <button type="button" class="qr-style-btn ${data.data.qrStyle === 'minimal' ? 'active' : ''}" data-style="minimal">极简</button>
                            <button type="button" class="qr-style-btn ${data.data.qrStyle === 'card' ? 'active' : ''}" data-style="card">卡片</button>
                            <button type="button" class="qr-style-btn ${data.data.qrStyle === 'horizontal' ? 'active' : ''}" data-style="horizontal">居中</button>
                            <button type="button" class="qr-style-btn ${data.data.qrStyle === 'elegant' ? 'active' : ''}" data-style="elegant">优雅</button>
                        </div>
                    `;
                case 'personnel':
                    return `
                        <div id="personnel-groups-${data.id}" class="personnel-groups-wrapper"></div>
                        <button type="button" class="add-btn component-add-personnel-group" style="margin-top: 1rem; padding: 0.5rem; font-size: 0.85rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <span>添加人员组</span>
                        </button>
                    `;
                default:
                    return '<p>未知组件类型</p>';
            }
        };

        // 绑定组件事件
        const bindComponentEvents = (component, componentData) => {
            const componentId = parseInt(component.dataset.componentId);

            // 折叠/展开 - 不影响其他组件
            const toggleBtn = component.querySelector('.component-toggle-btn');
            // 移除旧的监听器
            const newToggleBtn = toggleBtn.cloneNode(true);
            toggleBtn.parentNode.replaceChild(newToggleBtn, toggleBtn);
            
            newToggleBtn.addEventListener('click', () => {
                const content = component.querySelector('.component-content');
                const btn = component.querySelector('.component-toggle-btn');

                content.classList.toggle('collapsed');
                btn.innerHTML = content.classList.contains('collapsed')
                    ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>'
                    : '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"/></svg>';

                // 更新全部展开/收起按钮的状态
                updateToggleAllButtonState();
            });

            // 删除组件
            const removeBtn = component.querySelector('.component-remove-btn');
            // 移除旧的监听器
            const newRemoveBtn = removeBtn.cloneNode(true);
            removeBtn.parentNode.replaceChild(newRemoveBtn, removeBtn);
            
            newRemoveBtn.addEventListener('click', () => {
                posterComponents = posterComponents.filter(c => c.id !== componentId);
                component.remove();
                updatePoster();
            });

            // 拖拽事件 - 只允许通过拖拽手柄拖动
            const dragHandle = component.querySelector('.component-drag-handle');

            dragHandle.addEventListener('mousedown', () => {
                component.setAttribute('draggable', 'true');
            });

            dragHandle.addEventListener('mouseup', () => {
                component.setAttribute('draggable', 'false');
            });

            dragHandle.addEventListener('mouseleave', () => {
                component.setAttribute('draggable', 'false');
            });

            component.setAttribute('draggable', 'false');

            component.addEventListener('dragstart', (e) => {
                component.classList.add('dragging');
                e.dataTransfer.setData('text/plain', componentId);
            });

            component.addEventListener('dragend', () => {
                component.classList.remove('dragging');
                component.setAttribute('draggable', 'false');
                document.querySelectorAll('.poster-component').forEach(c => c.classList.remove('drag-over'));
            });

            component.addEventListener('dragover', (e) => {
                e.preventDefault();
                const dragging = document.querySelector('.poster-component.dragging');
                if (dragging !== component) {
                    component.classList.add('drag-over');
                }
            });

            component.addEventListener('dragleave', () => {
                component.classList.remove('drag-over');
            });

            component.addEventListener('drop', (e) => {
                e.preventDefault();
                component.classList.remove('drag-over');
                const draggedId = parseInt(e.dataTransfer.getData('text/plain'));
                const dropTargetId = parseInt(componentId);

                if (draggedId !== dropTargetId) {
                    // 更新数据顺序
                    const draggedIndex = posterComponents.findIndex(c => c.id === draggedId);
                    const dropIndex = posterComponents.findIndex(c => c.id === dropTargetId);

                    const [removed] = posterComponents.splice(draggedIndex, 1);
                    posterComponents.splice(dropIndex, 0, removed);

                    // 更新DOM顺序
                    const allComponents = Array.from(document.querySelectorAll('.poster-component'));
                    const draggedEl = allComponents.find(c => c.dataset.componentId == draggedId);
                    const dropEl = allComponents.find(c => c.dataset.componentId == dropTargetId);

                    if (draggedEl && dropEl) {
                        const container = document.getElementById('componentsContainer');
                        if (draggedIndex < dropIndex) {
                            container.insertBefore(draggedEl, dropEl.nextSibling);
                        } else {
                            container.insertBefore(draggedEl, dropEl);
                        }
                    }

                    updatePoster();
                }
            });

            // 输入框事件
            const inputs = component.querySelectorAll('.component-input-text');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    const field = input.dataset.field;
                    const compData = posterComponents.find(c => c.id == componentId);
                    if (compData) {
                        compData.data[field] = input.value;
                        updatePoster();
                    }
                });
            });

            // 对齐按钮事件
            const alignButtons = component.querySelectorAll('.component-align-buttons .align-btn');
            alignButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    alignButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const field = btn.closest('.component-align-buttons').dataset.field;
                    const align = btn.dataset.align;
                    const compData = posterComponents.find(c => c.id == componentId);

                    if (compData) {
                        compData.data[field] = align;
                        updatePoster();
                    }
                });
            });

            // 图片上传事件
            const imageInput = component.querySelector('.component-image-input');
            if (imageInput) {
                const label = component.querySelector('.image-upload-btn');
                if (label) {
                    label.setAttribute('for', `image-upload-${componentId}`);
                }
                imageInput.id = `image-upload-${componentId}`;

                imageInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (ev) => {
                            const compData = posterComponents.find(c => c.id === componentId);
                            if (compData) {
                                compData.data.image = ev.target.result;
                                // 重新渲染组件以更新UI
                                renderComponent(compData);
                                updatePoster();
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // 移除图片事件
            const removeImageBtn = component.querySelector('.component-remove-image');
            if (removeImageBtn) {
                removeImageBtn.addEventListener('click', () => {
                    const compData = posterComponents.find(c => c.id == componentId);
                    if (compData) {
                        compData.data.image = '';
                        // 重新渲染组件以更新UI
                        renderComponent(compData);
                        updatePoster();
                    }
                });
            }

            // 二维码图片上传事件
            const qrcodeInput = component.querySelector('.component-qrcode-input');
            if (qrcodeInput) {
                qrcodeInput.id = `qrcode-upload-${componentId}`;

                qrcodeInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (ev) => {
                            const compData = posterComponents.find(c => c.id === componentId);
                            if (compData) {
                                compData.data.qrcodeImage = ev.target.result;
                                // 重新渲染组件以更新UI
                                renderComponent(compData);
                                updatePoster();
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // 二维码上传按钮点击事件
            const qrUploadBtns = component.querySelectorAll('.qr-upload-icon');
            qrUploadBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const uploadId = btn.dataset.uploadId;
                    const compData = posterComponents.find(c => c.id === parseInt(uploadId));

                    // 如果已经有图片，则删除图片
                    if (compData && compData.data.qrcodeImage) {
                        compData.data.qrcodeImage = '';
                        renderComponent(compData);
                        updatePoster();
                    } else {
                        // 没有图片，则触发上传
                        const qrcodeInput = document.getElementById(`qrcode-upload-${uploadId}`);
                        if (qrcodeInput) {
                            qrcodeInput.click();
                        }
                    }
                });
            });

                // 图片样式选择事件
                const imageStyleBtns = component.querySelectorAll('.image-style-btn');
                if (imageStyleBtns.length > 0) {
                    imageStyleBtns.forEach(btn => {
                        btn.addEventListener('click', () => {
                            imageStyleBtns.forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');

                            const style = btn.dataset.style;
                            const compData = posterComponents.find(c => c.id === componentId);

                            if (compData) {
                                compData.data.style = style;
                                updatePoster();
                            }
                        });
                    });
                }

            // 文本样式选择事件
            const textStyleBtns = component.querySelectorAll('.text-style-btn');
            if (textStyleBtns.length > 0) {
                textStyleBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        textStyleBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        const style = btn.dataset.style;
                        const compData = posterComponents.find(c => c.id == componentId);

                        if (compData) {
                            compData.data.style = style;
                            updatePoster();
                        }
                    });
                });
            }

            // 二维码样式选择事件
            const qrStyleBtns = component.querySelectorAll('.qr-style-btn');
            if (qrStyleBtns.length > 0) {
                qrStyleBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        qrStyleBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');

                        const style = btn.dataset.style;
                        const compData = posterComponents.find(c => c.id == componentId);

                        if (compData) {
                            compData.data.qrStyle = style;
                            updatePoster();
                        }
                    });
                });
            }

            // 人员组件特殊处理
            if (componentData.type === 'personnel') {
                const personnelGroupsWrapper = component.querySelector(`#personnel-groups-${componentId}`);
                if (personnelGroupsWrapper && personnelGroups.length === 0) {
                    // 初始化人员组
                    const defaultGroups = [
                        {
                            title: '主持人',
                            visible: true,
                            persons: [
                                { name: '张明', title: '主持人', bio: '' }
                            ]
                        },
                        {
                            title: '分享嘉宾',
                            visible: true,
                            persons: [
                                { name: '李华', title: '资深设计师', bio: '10年设计经验，专注用户体验设计' },
                                { name: '王芳', title: '创意总监', bio: '曾获多项国际设计奖项' },
                                { name: '陈强', title: '用户体验专家', bio: '擅长用户研究与交互设计' }
                            ]
                        },
                        {
                            title: '总结嘉宾',
                            visible: true,
                            persons: [
                                { name: '刘静', title: '特邀嘉宾', bio: '' }
                            ]
                        }
                    ];

                    defaultGroups.forEach(group => {
                        createPersonnelGroup(personnelGroupsWrapper, group);
                    });
                }

                // 添加人员组按钮
                const addPersonnelGroupBtn = component.querySelector('.component-add-personnel-group');
                if (addPersonnelGroupBtn) {
                    addPersonnelGroupBtn.addEventListener('click', () => {
                        createPersonnelGroup(personnelGroupsWrapper, {
                            title: `人员组 ${groupCounter + 1}`,
                            visible: true,
                            persons: [
                                { name: '', title: '', bio: '' }
                            ]
                        });
                        updatePoster();
                    });
                }
            }
        };

        // 创建人员组
        const createPersonnelGroup = (container, data = {}) => {
            const groupId = ++groupCounter;
            const groupData = {
                id: groupId,
                title: data.title || `人员组 ${groupId}`,
                visible: data.visible !== undefined ? data.visible : true,
                persons: data.persons || []
            };

            personnelGroups.push(groupData);

            const group = document.createElement('div');
            group.className = 'personnel-group';
            group.dataset.groupId = groupId;
            group.innerHTML = `
                <div class="personnel-group-header">
                    <input type="text" class="personnel-group-title-input" value="${groupData.title}">
                    <div class="personnel-group-toggle">
                        <span>显示</span>
                        <div class="personnel-group-toggle-switch ${groupData.visible ? 'active' : ''}" data-group-id="${groupId}"></div>
                    </div>
                    <button type="button" class="personnel-group-remove" data-group-id="${groupId}" title="删除组">×</button>
                </div>
                <div class="personnel-group-content">
                    <div class="personnel-group-persons"></div>
                    <button type="button" class="add-btn" data-group-id="${groupId}" style="padding: 0.5rem; font-size: 0.85rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        <span>添加人员</span>
                    </button>
                </div>
            `;

            // 添加人员
            const personsContainer = group.querySelector('.personnel-group-persons');
            groupData.persons.forEach(person => {
                createPersonInGroup(personsContainer, groupId, person);
            });

            container.appendChild(group);

            // 绑定事件
            bindPersonnelGroupEvents(group);
        };

        // 创建组内人员
        const createPersonInGroup = (container, groupId, data = {}) => {
            let personCounter = 0;
            const personId = ++personCounter;
            
            const personBlock = document.createElement('div');
            personBlock.className = 'guest-block';
            personBlock.dataset.groupId = groupId;
            personBlock.dataset.personId = personId;
            personBlock.innerHTML = `
                <div class="guest-block-grid">
                    <div class="guest-photo-area">
                        <div class="guest-photo-wrapper">
                            <div class="guest-photo-preview">
                                <span>照片</span>
                            </div>
                            <div class="guest-photo-overlay">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                            </div>
                        </div>
                        <input type="file" class="form-input guest-photo" accept="image/*" style="display: none;">
                        <div class="guest-photo-controls">
                            <button type="button" class="photo-control-btn move-btn" data-action="move-up" title="上移">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="18 15 12 9 6 15"/>
                                </svg>
                            </button>
                            <button type="button" class="photo-control-btn move-btn" data-action="move-left" title="左移">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"/>
                                </svg>
                            </button>
                            <button type="button" class="photo-control-btn move-btn" data-action="move-down" title="下移">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <button type="button" class="photo-control-btn move-btn" data-action="move-right" title="右移">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 6 15 12 9 18"/>
                                </svg>
                            </button>
                            <button type="button" class="photo-control-btn zoom-btn" data-action="zoom-in" title="放大">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                    <line x1="11" y1="8" x2="11" y2="14"/>
                                    <line x1="8" y1="11" x2="14" y2="11"/>
                                </svg>
                            </button>
                            <button type="button" class="photo-control-btn zoom-btn" data-action="zoom-out" title="缩小">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                    <line x1="8" y1="11" x2="14" y2="11"/>
                                </svg>
                            </button>
                        </div>
                        <div class="guest-layout-controls">
                            <button type="button" class="layout-btn active" data-layout="compact" title="紧凑布局">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7" rx="1"/>
                                    <rect x="14" y="3" width="7" height="7" rx="1"/>
                                    <rect x="3" y="14" width="7" height="7" rx="1"/>
                                    <rect x="14" y="14" width="7" height="7" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="layout-btn" data-layout="card" title="卡片布局">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="4" y="4" width="16" height="16" rx="2"/>
                                    <line x1="4" y1="10" x2="20" y2="10"/>
                                </svg>
                            </button>
                            <button type="button" class="layout-btn" data-layout="minimal" title="极简布局">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="8" r="4"/>
                                    <line x1="4" y1="20" x2="20" y2="20"/>
                                </svg>
                            </button>
                            <button type="button" class="layout-btn" data-layout="text" title="纯文字布局">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="4" y1="6" x2="20" y2="6"/>
                                    <line x1="4" y1="12" x2="20" y2="12"/>
                                    <line x1="4" y1="18" x2="16" y2="18"/>
                                </svg>
                            </button>
                            <button type="button" class="layout-btn" data-layout="sidebar" title="侧边布局">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="18" rx="1"/>
                                    <rect x="13" y="5" width="8" height="3" rx="1"/>
                                    <rect x="13" y="11" width="8" height="3" rx="1"/>
                                    <rect x="13" y="17" width="6" height="3" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="layout-btn" data-layout="grid" title="网格布局">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7" rx="1"/>
                                    <rect x="14" y="3" width="7" height="7" rx="1"/>
                                    <rect x="3" y="14" width="7" height="7" rx="1"/>
                                    <rect x="14" y="14" width="7" height="7" rx="1"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="guest-info-area">
                        <button type="button" class="guest-remove-btn">×</button>
                        <div class="guest-name-wrapper">
                            <label>姓名</label>
                            <input type="text" class="form-input guest-name" value="${data.name || ''}" placeholder="姓名">
                        </div>
                        <div class="guest-title-wrapper">
                            <label>头衔</label>
                            <input type="text" class="form-input guest-title" value="${data.title || ''}" placeholder="头衔">
                        </div>
                        <div class="guest-bio-wrapper">
                            <label>简介</label>
                            <textarea class="form-textarea guest-bio" placeholder="嘉宾简介" rows="2">${data.bio || ''}</textarea>
                        </div>
                    </div>
                </div>
            `;

            // 存储变换数据
            personBlock.dataset.photoTransform = JSON.stringify({
                scale: 1,
                offsetX: 0,
                offsetY: 0
            });

            // 存储布局偏好
            personBlock.dataset.layout = 'compact';

            container.appendChild(personBlock);

            // 绑定人员块事件
            bindPersonBlockEvents(personBlock);

            return personBlock;
        };

        // 绑定人员组事件
        const bindPersonnelGroupEvents = (group) => {
            const groupId = group.dataset.groupId;

            // 标题输入事件
            group.querySelector('.personnel-group-title-input').addEventListener('input', (e) => {
                const groupData = personnelGroups.find(g => g.id == groupId);
                if (groupData) {
                    groupData.title = e.target.value;
                    updatePoster();
                }
            });

            // 显示/隐藏切换
            group.querySelector('.personnel-group-toggle-switch').addEventListener('click', () => {
                const toggle = group.querySelector('.personnel-group-toggle-switch');
                toggle.classList.toggle('active');
                const groupData = personnelGroups.find(g => g.id == groupId);
                if (groupData) {
                    groupData.visible = toggle.classList.contains('active');
                    updatePoster();
                }
            });

            // 删除组
            group.querySelector('.personnel-group-remove').addEventListener('click', () => {
                const groups = document.querySelectorAll('.personnel-group');
                if (groups.length > 1) {
                    personnelGroups = personnelGroups.filter(g => g.id != groupId);
                    group.remove();
                    updatePoster();
                } else {
                    alert('至少保留一个人员组');
                }
            });

            // 添加人员
            group.querySelector('.add-btn').addEventListener('click', () => {
                const personsContainer = group.querySelector('.personnel-group-persons');
                createPersonInGroup(personsContainer, groupId);
                updatePoster();
            });
        };

        // 绑定人员块事件
        const bindPersonBlockEvents = (block) => {
            const groupId = block.dataset.groupId;
            const personId = block.dataset.personId;

            // 照片预览
            const photoInput = block.querySelector('.guest-photo');
            const photoPreview = block.querySelector('.guest-photo-preview');
            const photoWrapper = block.querySelector('.guest-photo-wrapper');

            photoInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        photoPreview.innerHTML = `<img src="${ev.target.result}" alt="人员照片">`;
                        photoPreview.classList.add('has-image');
                        updatePoster();
                    };
                    reader.readAsDataURL(file);
                } else {
                    photoPreview.innerHTML = `<span>照片</span>`;
                    photoPreview.classList.remove('has-image');
                    updatePoster();
                }
            });

            photoWrapper.addEventListener('click', () => {
                photoInput.click();
            });

            // 照片控制按钮
            const controlBtns = block.querySelectorAll('.photo-control-btn');
            controlBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    const img = photoPreview.querySelector('img');

                    if (!img) return;

                    const photoTransform = JSON.parse(block.dataset.photoTransform);
                    const step = 2;

                    switch(action) {
                        case 'zoom-in':
                            photoTransform.scale = Math.min(photoTransform.scale + 0.1, 2);
                            break;
                        case 'zoom-out':
                            photoTransform.scale = Math.max(photoTransform.scale - 0.1, 0.5);
                            break;
                        case 'move-up':
                            photoTransform.offsetY -= step;
                            break;
                        case 'move-down':
                            photoTransform.offsetY += step;
                            break;
                        case 'move-left':
                            photoTransform.offsetX -= step;
                            break;
                        case 'move-right':
                            photoTransform.offsetX += step;
                            break;
                    }

                    block.dataset.photoTransform = JSON.stringify(photoTransform);
                    img.style.transform = `translate(${photoTransform.offsetX}px, ${photoTransform.offsetY}px) scale(${photoTransform.scale})`;
                    img.style.transformOrigin = 'center center';
                    updatePoster();
                });
            });

            // 布局切换按钮
            const layoutBtns = block.querySelectorAll('.layout-btn');
            const photoControls = block.querySelector('.guest-photo-controls');

            layoutBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    layoutBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const layout = btn.dataset.layout;
                    block.dataset.layout = layout;

                    if (layout === 'text') {
                        photoWrapper.style.opacity = '0.5';
                        photoWrapper.style.pointerEvents = 'none';
                        controlBtns.forEach(btn => {
                            btn.disabled = true;
                            btn.style.opacity = '0.4';
                            btn.style.cursor = 'not-allowed';
                        });
                    } else {
                        photoWrapper.style.opacity = '1';
                        photoWrapper.style.pointerEvents = 'auto';
                        controlBtns.forEach(btn => {
                            btn.disabled = false;
                            btn.style.opacity = '1';
                            btn.style.cursor = 'pointer';
                        });
                    }

                    updatePoster();
                });
            });

            // 删除按钮
            block.querySelector('.guest-remove-btn').addEventListener('click', () => {
                const personsContainer = block.parentElement;
                const persons = personsContainer.querySelectorAll('.guest-block');
                if (persons.length > 1) {
                    block.remove();
                    updatePoster();
                } else {
                    alert('至少保留一个人员');
                }
            });

            // 输入框事件
            ['input', 'change'].forEach(eventType => {
                block.querySelectorAll('input, textarea').forEach(input => {
                    input.addEventListener(eventType, () => {
                        updatePoster();
                    });
                });
            });
        };

        // 组件类型选择
        const componentTypeButtons = document.getElementById('componentTypeButtons');
        const addComponentBtn = document.getElementById('addComponentBtn');
        const componentTypeOptions = document.querySelectorAll('.component-type-option');
        const addComponentContainer = document.getElementById('addComponentContainer');



        componentTypeOptions.forEach(option => {
            option.addEventListener('click', () => {
                const type = option.dataset.type;
                let defaultData = {};
                
                // 为二维码组件设置默认数据
                if (type === 'qrcode') {
                    defaultData = { 
                        link: 'https://example.com/event', 
                        text: '扫码查看', 
                        subtitle: 'Scan to view',
                        time: '2024年3月15日  06:00-07:00',
                        location: '浙江省桐乡市凯旋路1888号',
                        qrStyle: 'default'
                    };
                }
                
                createComponent({ type: type, visible: true, data: defaultData });
                updatePoster();
            });
        });

        // 整体控制按钮
        const toggleAllComponentsBtn = document.getElementById('toggleAllComponentsBtn');
        const setCornerBtn = document.getElementById('setCornerBtn');
        let posterRounded = true;

        // 更新全部展开/收起按钮状态
        const updateToggleAllButtonState = () => {
            const allComponents = document.querySelectorAll('.poster-component');
            const allCollapsed = Array.from(allComponents).every(comp => {
                return comp.querySelector('.component-content').classList.contains('collapsed');
            });

            const btnContent = toggleAllComponentsBtn.querySelector('span');
            btnContent.textContent = allCollapsed ? '全部展开' : '全部收起';
        };

        toggleAllComponentsBtn.addEventListener('click', () => {
            const allComponents = document.querySelectorAll('.poster-component');
            const btn = toggleAllComponentsBtn;
            const btnContent = btn.querySelector('span');

            // 判断当前是否全部展开
            const allCollapsed = Array.from(allComponents).every(comp => {
                return comp.querySelector('.component-content').classList.contains('collapsed');
            });

            // 切换所有组件状态
            allComponents.forEach(component => {
                const content = component.querySelector('.component-content');
                const toggleBtn = component.querySelector('.component-toggle-btn');

                if (allCollapsed) {
                    // 全部展开
                    content.classList.remove('collapsed');
                    toggleBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"/></svg>';
                } else {
                    // 全部收起
                    content.classList.add('collapsed');
                    toggleBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>';
                }
            });

            btnContent.textContent = allCollapsed ? '全部收起' : '全部展开';
        });

        setCornerBtn.addEventListener('click', () => {
            const poster = document.getElementById('poster');
            const btn = setCornerBtn;
            const btnContent = btn.querySelector('span');

            posterRounded = !posterRounded;

            if (posterRounded) {
                poster.classList.remove('squared');
                poster.classList.add('rounded');
                btnContent.textContent = '圆角';
            } else {
                poster.classList.remove('rounded');
                poster.classList.add('squared');
                btnContent.textContent = '直角';
            }
        });

        // 添加人员组按钮（用于人员组件）

        // 更新海报
        const updatePoster = () => {
            const posterContent = document.querySelector('.poster-content');

            // 清除旧的组件内容
            posterContent.innerHTML = '';

            // 遍历所有组件，生成海报内容
            posterComponents.forEach(comp => {
                if (!comp.visible) return;

                const wrapper = document.createElement('div');
                wrapper.className = 'poster-component-wrapper';
                wrapper.dataset.componentId = comp.id;

                switch(comp.type) {
                    case 'main-title':
                        wrapper.innerHTML = `<div class="poster-title" style="text-align: ${comp.data.align || 'left'}">${comp.data.text || ''}</div>`;
                        break;
                    case 'sub-title':
                        wrapper.innerHTML = `<div class="poster-subtitle" style="text-align: ${comp.data.align || 'left'}">${comp.data.text || ''}</div>`;
                        break;
                    case 'text-box':
                        const textStyle = comp.data.style || 'default';
                        wrapper.innerHTML = `<div class="poster-description style-${textStyle}">${comp.data.text || ''}</div>`;
                        break;
                    case 'image':
                        if (comp.data.image) {
                            const imageStyle = comp.data.style || 'default';
                            wrapper.innerHTML = `<img src="${comp.data.image}" alt="封面图片" class="poster-cover-image style-${imageStyle}" crossorigin="anonymous">`;
                        } else {
                            wrapper.classList.add('hidden');
                        }
                        break;
                    case 'qrcode':
                        let qrImageSrc = '';
                        if (comp.data.qrcodeImage) {
                            qrImageSrc = comp.data.qrcodeImage;
                        } else if (comp.data.link) {
                            qrImageSrc = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(comp.data.link)}`;
                        }

                        const qrStyle = comp.data.qrStyle || 'default';
                        let qrHTML = '';

                        // 根据不同样式生成不同的HTML结构
                        switch(qrStyle) {
                            case 'minimal':
                                qrHTML = `
                                    <div class="poster-qr style-minimal">
                                        ${qrImageSrc ?
                                            `<img src="${qrImageSrc}" alt="二维码" crossorigin="anonymous">` :
                                            `<div class="qrcode-placeholder" style="width: 80px; height: 80px; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="1">
                                                    <rect x="3" y="3" width="7" height="7"/>
                                                    <rect x="14" y="3" width="7" height="7"/>
                                                    <rect x="14" y="14" width="7" height="7"/>
                                                    <path d="M3 21h7v-7H3v7z"/>
                                                </svg>
                                            </div>`
                                        }
                                        <div class="qr-section-right">
                                            ${(comp.data.time || comp.data.location) ? `
                                                <div class="poster-event-details">
                                                    ${comp.data.time ? `
                                                        <div class="event-detail">
                                                            <svg class="event-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                                            </svg>
                                                            <span>${comp.data.time}</span>
                                                        </div>
                                                    ` : ''}
                                                    ${comp.data.location ? `
                                                        <div class="event-detail">
                                                            <svg class="event-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                                                <circle cx="12" cy="10" r="3"/>
                                                            </svg>
                                                            <span>${comp.data.location}</span>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'card':
                                qrHTML = `
                                    <div class="poster-qr style-card">
                                        <div class="qr-section-left">
                                            ${qrImageSrc ?
                                                `<img src="${qrImageSrc}" alt="二维码" crossorigin="anonymous">` :
                                                `<div class="qrcode-placeholder" style="width: 70px; height: 70px; background: #f1f5f9; border-radius: 0; display: flex; align-items: center; justify-content: center;">
                                                    <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5">
                                                        <rect x="3" y="3" width="7" height="7"/>
                                                        <rect x="14" y="3" width="7" height="7"/>
                                                        <rect x="14" y="14" width="7" height="7"/>
                                                        <path d="M3 21h7v-7H3v7z"/>
                                                    </svg>
                                                </div>`
                                            }
                                        </div>
                                        <div class="qr-section-right">
                                            ${(comp.data.time || comp.data.location) ? `
                                                <div class="poster-event-details">
                                                    ${comp.data.time ? `
                                                        <div class="event-detail">
                                                            <svg class="event-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                                            </svg>
                                                            <span>${comp.data.time}</span>
                                                        </div>
                                                    ` : ''}
                                                    ${comp.data.location ? `
                                                        <div class="event-detail">
                                                            <svg class="event-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                                                <circle cx="12" cy="10" r="3"/>
                                                            </svg>
                                                            <span>${comp.data.location}</span>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                                break;
                            case 'horizontal':
                                qrHTML = `
                                    <div class="qr-wrapper-horizontal">
                                        <div class="poster-qr style-horizontal">
                                            ${qrImageSrc ?
                                                `<img src="${qrImageSrc}" alt="二维码" crossorigin="anonymous">` :
                                                `<div class="qrcode-placeholder" style="width: 70px; height: 70px; background: #f8fafc; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                    <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="1.5">
                                                        <rect x="3" y="3" width="7" height="7"/>
                                                        <rect x="14" y="3" width="7" height="7"/>
                                                        <rect x="14" y="14" width="7" height="7"/>
                                                        <path d="M3 21h7v-7H3v7z"/>
                                                    </svg>
                                                </div>`
                                            }
                                        </div>
                                        ${(comp.data.time || comp.data.location) ? `
                                            <div class="horizontal-info">
                                                ${comp.data.time ? `
                                                    <div class="poster-info">
                                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                            <line x1="16" y1="2" x2="16" y2="6"/>
                                                            <line x1="8" y1="2" x2="8" y2="6"/>
                                                            <line x1="3" y1="10" x2="21" y2="10"/>
                                                        </svg>
                                                        <span>${comp.data.time}</span>
                                                    </div>
                                                ` : ''}
                                                ${comp.data.location ? `
                                                    <div class="poster-info">
                                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                                            <circle cx="12" cy="10" r="3"/>
                                                        </svg>
                                                        <span>${comp.data.location}</span>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                                break;
                            case 'elegant':
                                qrHTML = `
                                    <div class="poster-qr style-elegant">
                                        <div class="qr-section-left">
                                            ${qrImageSrc ?
                                                `<img src="${qrImageSrc}" alt="二维码" crossorigin="anonymous">` :
                                                `<div class="qrcode-placeholder" style="width: 70px; height: 70px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                                    <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="1.5">
                                                        <rect x="3" y="3" width="7" height="7"/>
                                                        <rect x="14" y="3" width="7" height="7"/>
                                                        <rect x="14" y="14" width="7" height="7"/>
                                                        <path d="M3 21h7v-7H3v7z"/>
                                                    </svg>
                                                </div>`
                                            }
                                        </div>
                                        <div class="qr-section-right">
                                            ${(comp.data.time || comp.data.location) ? `
                                                <div class="poster-event-details">
                                                    ${comp.data.time ? `
                                                        <div class="event-detail">
                                                            <svg class="event-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                                            </svg>
                                                            <span>${comp.data.time}</span>
                                                        </div>
                                                    ` : ''}
                                                    ${comp.data.location ? `
                                                        <div class="event-detail">
                                                            <svg class="event-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                                                <circle cx="12" cy="10" r="3"/>
                                                            </svg>
                                                            <span>${comp.data.location}</span>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                                break;
                            default: // default
                                qrHTML = `
                                    <div class="qr-wrapper-default">
                                        <div class="poster-qr style-default">
                                            ${qrImageSrc ?
                                                `<img src="${qrImageSrc}" alt="二维码" crossorigin="anonymous">` :
                                                `<div class="qrcode-placeholder" style="width: 70px; height: 70px; background: rgba(128, 128, 128, 0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                    <svg width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="rgba(128, 128, 128, 0.6)" stroke-width="1">
                                                        <rect x="3" y="3" width="7" height="7"/>
                                                        <rect x="14" y="3" width="7" height="7"/>
                                                        <rect x="14" y="14" width="7" height="7"/>
                                                        <path d="M3 21h7v-7H3v7z"/>
                                                    </svg>
                                                </div>`
                                            }
                                        </div>
                                        <div class="poster-info-group-right">
                                            ${comp.data.time ? `
                                                <div class="poster-info">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                        <line x1="16" y1="2" x2="16" y2="6"/>
                                                        <line x1="8" y1="2" x2="8" y2="6"/>
                                                        <line x1="3" y1="10" x2="21" y2="10"/>
                                                    </svg>
                                                    <span>${comp.data.time}</span>
                                                </div>
                                            ` : ''}
                                            ${comp.data.location ? `
                                                <div class="poster-info">
                                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
                                                        <circle cx="12" cy="10" r="3"/>
                                                    </svg>
                                                    <span>${comp.data.location}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                        }

                        wrapper.innerHTML = qrHTML;
                        break;
                    case 'personnel':
                        // 人员组件：渲染所有人员组
                        personnelGroups.forEach(group => {
                            if (!group.visible) return;

                            const groupElement = document.querySelector(`.personnel-group[data-group-id="${group.id}"]`);
                            if (!groupElement) return;

                            const personBlocks = groupElement.querySelectorAll('.guest-block');
                            if (personBlocks.length === 0) return;

                            const groupSection = document.createElement('div');
                            groupSection.className = 'poster-section';
                            groupSection.style.marginTop = '1rem';
                            groupSection.style.marginBottom = '1rem';

                            const personsContainer = document.createElement('div');

                            // 生成人员列表HTML
                            personBlocks.forEach(block => {
                                const name = block.querySelector('.guest-name').value;
                                const title = block.querySelector('.guest-title').value;
                                const bio = block.querySelector('.guest-bio').value;
                                const photoPreviewImg = block.querySelector('.guest-photo-preview img');

                                const guestElement = document.createElement('div');
                                guestElement.dataset.blockIndex = block.dataset.personId;

                                // 获取变换数据
                                let photoTransform;
                                try {
                                    photoTransform = JSON.parse(block.dataset.photoTransform || '{"scale":1,"offsetX":0,"offsetY":0}');
                                } catch (e) {
                                    photoTransform = {scale: 1, offsetX: 0, offsetY: 0};
                                }

                                // 头像处理
                                const defaultAvatar = `<svg viewBox="0 0 100 100" style="width:100%;height:100%;opacity:0.6;display:flex;align-items:center;justify-content:center;">
                                    <circle cx="50" cy="40" r="18" fill="currentColor"/>
                                    <path d="M25 75 Q50 50 75 75" stroke="currentColor" stroke-width="6" fill="none" stroke-linecap="round"/>
                                </svg>`;

                                let avatarContent;
                                if (photoPreviewImg && photoPreviewImg.src) {
                                    avatarContent = `<img src="${photoPreviewImg.src}" alt="${name || ''}" style="transform: translate(${photoTransform.offsetX}px, ${photoTransform.offsetY}px) scale(${photoTransform.scale}); transform-origin: center center; transition: transform 0.2s ease;" crossorigin="anonymous">`;
                                } else {
                                    avatarContent = defaultAvatar;
                                }

                                // 判断显示模式
                                const hasName = name && name.trim();
                                const hasTitle = title && title.trim();
                                const hasBio = bio && bio.trim();
                                const layout = block.dataset.layout || 'compact';

                                if (hasName && !hasTitle && !hasBio) {
                                    guestElement.className = `poster-guest name-only layout-${layout}`;
                                    guestElement.innerHTML = `
                                        <div class="poster-guest-avatar">${avatarContent}</div>
                                        <div class="poster-guest-info">
                                            <div class="poster-guest-name">${name}</div>
                                        </div>
                                    `;
                                } else if (hasName && hasTitle && !hasBio) {
                                    guestElement.className = `poster-guest with-title layout-${layout}`;
                                    guestElement.innerHTML = `
                                        <div class="poster-guest-avatar">${avatarContent}</div>
                                        <div class="poster-guest-info">
                                            <div class="poster-guest-name">${name}</div>
                                            <div class="poster-guest-title">${title}</div>
                                        </div>
                                    `;
                                } else {
                                    const displayTitle = hasTitle ? title : '';
                                    const displayBio = hasBio ? bio : '';
                                    guestElement.className = `poster-guest with-bio layout-${layout}`;
                                    guestElement.innerHTML = `
                                        <div class="poster-guest-left">
                                            <div class="poster-guest-avatar">${avatarContent}</div>
                                            <div class="poster-guest-info">
                                                <div class="poster-guest-name">${name || '嘉宾'}</div>
                                                ${displayTitle ? `<div class="poster-guest-title">${displayTitle}</div>` : ''}
                                            </div>
                                        </div>
                                        ${displayBio ? `<div class="poster-guest-bio">${displayBio}</div>` : ''}
                                    `;
                                }

                                personsContainer.appendChild(guestElement);
                            });

                            // 如果有多个人，使用poster-guests类
                            if (personBlocks.length > 1) {
                                personsContainer.className = 'poster-guests';
                            }

                            // 创建组标题和内容
                            groupSection.innerHTML = `
                                <div class="poster-section-title">${group.title}</div>
                            `;
                            groupSection.appendChild(personsContainer);

                            wrapper.appendChild(groupSection);
                        });
                        break;
                }

                posterContent.appendChild(wrapper);
            });

            console.log('海报更新完成，当前有', posterComponents.filter(c => c.visible).length, '个可见组件');
        };

        // 背景渐变切换
        document.querySelectorAll('.gradient-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.gradient-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                const gradient = this.dataset.gradient;
                document.getElementById('poster').style.background = `var(--gradient-${gradient})`;
            });
        });

        // 对齐按钮功能（已移至组件事件绑定中）

        // 文本更新和二维码更新已整合到组件事件绑定中

        // DOM 加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 加载完成，开始初始化组件系统...');

            setTimeout(() => {
                initComponentSystem();

                // 导出海报
                const exportBtn = document.getElementById('exportBtn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', async function() {
                        console.log('开始导出海报...');
                        
                        if (typeof html2canvas === 'undefined') {
                            alert('html2canvas库未加载，请刷新页面重试');
                            console.error('html2canvas is not defined');
                            return;
                        }
                        
                        const poster = document.getElementById('poster');

                        if (!poster) {
                            alert('未找到海报元素');
                            return;
                        }

                        try {
                            // 显示导出提示
                            exportBtn.disabled = true;
                            exportBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg><span>导出中...</span>';
                            
                            const canvas = await html2canvas(poster, {
                                scale: 2,
                                useCORS: true,
                                allowTaint: true,
                                backgroundColor: '#ffffff',
                                logging: true,
                                ignoreElements: function(element) {
                                    // 忽略隐藏或不可见元素
                                    return element.style.display === 'none' || 
                                           element.style.visibility === 'hidden' ||
                                           element.style.opacity === '0';
                                },
                                onclone: function(clonedDoc) {
                                    // 确保克隆的文档中所有样式都正确
                                    const clonedPoster = clonedDoc.getElementById('poster');
                                    if (clonedPoster) {
                                        clonedPoster.style.display = 'block';
                                        clonedPoster.style.visibility = 'visible';
                                        clonedPoster.style.opacity = '1';
                                        clonedPoster.style.position = 'relative';
                                        clonedPoster.style.zIndex = '1';
                                        
                                        // 确保所有图片都加载完成
                                        const images = clonedPoster.querySelectorAll('img');
                                        images.forEach(img => {
                                            if (!img.complete) {
                                                img.onload = function() {
                                                    console.log('图片加载完成:', img.src);
                                                };
                                            }
                                        });
                                    }
                                }
                            });

                            // 确保画布已完全生成
                            if (!canvas || canvas.width === 0 || canvas.height === 0) {
                                throw new Error('Canvas generation failed');
                            }

                            console.log('画布生成成功，尺寸:', canvas.width, 'x', canvas.height);

                            const link = document.createElement('a');
                            link.download = 'poster.png';
                            link.href = canvas.toDataURL('image/png', 1.0);
                            
                            // 触发下载
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);

                            console.log('海报导出成功');
                            
                            // 恢复按钮状态
                            exportBtn.disabled = false;
                            exportBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg><span>导出海报</span>';
                            
                            alert('海报导出成功！');
                        } catch (error) {
                            alert('导出失败: ' + (error.message || '请检查网络连接后重试'));
                            console.error('Export error:', error);
                            
                            // 恢复按钮状态
                            exportBtn.disabled = false;
                            exportBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg><span>导出海报</span>';
                        }
                    });
                } else {
                    console.error('未找到导出按钮');
                }

                setTimeout(() => {
                    updatePoster();
                }, 100);
            }, 200);
        });
    </script>
</body>
</html>